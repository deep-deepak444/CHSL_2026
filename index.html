<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deep Study</title>
  <link rel="stylesheet" href="style.css">
  
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#001f3f">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Deep Study">
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
</head>
<body class="gradient-animated">

  <div id="install-popup" class="install-popup">
    <span>Install now DEEP STUDY QUIZ App : </span>
    <button id="install-btn" class="install-btn">Install</button>
    <button id="close-install-popup" class="close-btn">&times;</button>
  </div>
  <section id="entryPage">
    <h1 class="welcome-text">
      WELCOME <br> To Your <br> ЁЯОЙDREAMЁЯОЙ
    </h1>
    <button class="start-btn">Start тЖТ</button>
  </section>
  
  <script>
    // --- рдпрд╣рд╛рдБ рд╕реЗ рдирдпрд╛ рдХреЛрдб рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ ---
    let deferredPrompt;
    const installPopup = document.getElementById('install-popup');
    const installBtn = document.getElementById('install-btn');
    const closeInstallBtn = document.getElementById('close-install-popup');

    // рдпрд╣ рдЗрд╡реЗрдВрдЯ рдРрдк рдХреЛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рджреЗрддрд╛ рд╣реИ
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault(); // рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреНрд░реЙрдореНрдкреНрдЯ рд░реЛрдХреЗрдВ
      deferredPrompt = e; // рдмрд╛рдж рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдЗрд╡реЗрдВрдЯ рдХреЛ рд╕рд╣реЗрдЬреЗрдВ
    });

    // рдРрдк рдЗрдВрд╕реНрдЯреЙрд▓ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдпрд╣ рдЗрд╡реЗрдВрдЯ рдлрд╛рдпрд░ рд╣реЛрддрд╛ рд╣реИ
    window.addEventListener('appinstalled', () => {
      console.log('PWA was installed');
      localStorage.setItem('appInstalled', 'true'); // localStorage рдореЗрдВ рд╕реЗрд╡ рдХрд░реЗрдВ
      installPopup.classList.remove('show'); // рдкреЙрдк-рдЕрдк рдЫрд┐рдкрд╛рдПрдБ
      deferredPrompt = null;
    });
    // --- рдпрд╣рд╛рдБ рддрдХ рдирдпрд╛ рдХреЛрдб рд╣реИ ---


    window.onload = function() {
      const quizProgress = JSON.parse(localStorage.getItem('quizProgress'));
      const startBtn = document.querySelector('.start-btn');

      // рдпрд╣ рдЬрд╛рдВрдЪ рдХрд░реЗрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдХреНрд╡рд┐рдЬрд╝ рдЕрдзреВрд░рд╛ рд╣реИ
      if (quizProgress && quizProgress.subject) {
        startBtn.textContent = "Resume Quiz ЁЯЪА";
        startBtn.onclick = function() {
          window.location.href = `quiz.html?subject=${quizProgress.subject}&topic=${quizProgress.topic}`;
        };
      } 
      // рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рд╡рд┐рд╡рд░рдг рдкреГрд╖реНрда рдкрд░ рдЬрд╛рдПрдЧрд╛
      else {
        startBtn.onclick = function() {
          window.location.href = 'study.html';
        };
      }

      // --- рдпрд╣рд╛рдБ рд╕реЗ рдирдпрд╛ рдкреЙрдк-рдЕрдк рджрд┐рдЦрд╛рдиреЗ рдХрд╛ рд▓реЙрдЬрд┐рдХ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ ---
      const appInstalled = localStorage.getItem('appInstalled') === 'true';

      // рдпрджрд┐ рдРрдк рдкрд╣рд▓реЗ рд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдирд╣реАрдВ рд╣реИ, рддреЛ 3 рд╕реЗрдХрдВрдб рдмрд╛рдж рдкреЙрдк-рдЕрдк рджрд┐рдЦрд╛рдПрдБ
      if (!appInstalled) {
        setTimeout(() => {
          if (deferredPrompt) { // рдХреЗрд╡рд▓ рддрднреА рджрд┐рдЦрд╛рдПрдБ рдЬрдм рдРрдк рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╣реЛ
            installPopup.classList.add('show');
          }
        }, 2000);
      }
      
      // рдЗрдВрд╕реНрдЯреЙрд▓ рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХреЛ рд╣реИрдВрдбрд▓ рдХрд░реЗрдВ
      installBtn.addEventListener('click', async () => {
        if (!deferredPrompt) {
          return;
        }
        
        installBtn.textContent = 'Installing...'; // рдмрдЯрди рдЯреЗрдХреНрд╕реНрдЯ рдмрджрд▓реЗрдВ
        installBtn.disabled = true;

        deferredPrompt.prompt(); // рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдкреНрд░реЙрдореНрдкреНрдЯ рджрд┐рдЦрд╛рдПрдБ

        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          console.log('User accepted the install prompt');
        } else {
          console.log('User dismissed the install prompt');
          installBtn.textContent = 'Install'; // рдЕрдЧрд░ рдпреВрдЬрд░ рдордирд╛ рдХрд░реЗ рддреЛ рдмрдЯрди рдХреЛ рд╡рд╛рдкрд╕ рдареАрдХ рдХрд░реЗрдВ
          installBtn.disabled = false;
        }
      });
      
      // рдкреЙрдк-рдЕрдк рдмрдВрдж рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдмрдЯрди рдХреЛ рд╣реИрдВрдбрд▓ рдХрд░реЗрдВ
      closeInstallBtn.addEventListener('click', () => {
        installPopup.classList.remove('show');
      });
      // --- рдпрд╣рд╛рдБ рддрдХ рдкреЙрдк-рдЕрдк рд▓реЙрдЬрд┐рдХ рд╣реИ ---
    };
  </script>

</body>
</html>
